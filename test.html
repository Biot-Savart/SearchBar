<style type="text/css">
    .container {
    height:100px;
    border-color:black;
    overflow:auto;
}
li {
    outline: none;
    cursor: default;
}
.active{
    background-color:yellow;    
}
</style>



<div class="container">
    <ul>
        <li  tabindex="1">item1</li>
        <li  tabindex="2">item2</li>
        <li  tabindex="3">item3</li>
        <li tabindex="4">item4</li>
        <li tabindex="5">item5</li>
        <li tabindex="6">item6</li>
        <li tabindex="7">item7</li>
        <li tabindex="8">item8</li>
        <li tabindex="9">item9</li>
        <li tabindex="10">item10</li>
    </ul>
</div>


<ul class="dropdown-menu customDropDown">
                  
                  <li><input id="searchText" placeholder="Search..." /><li>    

                  <li id="searchTable"></li>  
    

                 
                  
                  
                </ul>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>

<script src="js/bootstrap.min.js"></script>
<script type="text/javascript">
    
  /*  $(document).ready(function () { 
$('div.container').on('focus', 'li', function() {

    $this = $(this);
    $this.addClass('active').siblings().removeClass();
    $this.closest('div.container').scrollTop($this.index() * $this.outerHeight());
}).on('keydown', 'li', function(e) {
    $this = $(this);
    if (e.keyCode == 40) {        
        $this.next().focus();
        return false;
    } else if (e.keyCode == 38) {        
        $this.prev().focus();
        return false;
    }
}).find('li').first().focus();
});
*/


var searchInterval;
var data;


$(document).ready(function () {  

    loadData();

    $('#searchText')
    .keyup(function(event)
        {
            //clear the search interval
            clearInterval(searchInterval);
            //only execute search after no input for 500 ms
            searchInterval = setInterval(function(){search(event.currentTarget.value.toLowerCase())},500);              
        })
    .keydown( function(event) {
            if(event.keyCode == 13) {
                search(event.currentTarget.value.toLowerCase());
            }
        });

    
});

function loadData()
{
    $.getJSON( "https://raw.githubusercontent.com/Biot-Savart/SearchBar/develop/data.json", function( pdata ) {
        
        data = pdata;   //store data because data does not change. If live system the data call will be done on every search.

        search("");         
            
  });
        

}

function addSearch(data,searchText)
{
    var table = "<ul class='projectList'>";
    table += '<li role="separator" class="divider" id="firstDevider"></li>';
        for (var pcount = 0; pcount < data.length; pcount++)
        {       

            table += "<div class='row'><div class='col-md-1'><img src='"+data[pcount].image.link+"'/></div><div class='col-md-6' id='testdiv'><li class='dropdown-header projectName' id='testf' ><a href='#''>" + highlightWords(data[pcount].name,searchText) + "</a></li>";
            table += "<ul class='groupList'>";
            //debugger;
            for (var groupCount = 0; groupCount < data[pcount].groups.length; groupCount++) {
                table += "<li class='groupName'><a href='"+data[pcount].groups[groupCount].url+"''>"+highlightWords(data[pcount].groups[groupCount].name,searchText)+"</a></li>";
            }

            table += "</ul></div></div>";

            table += '<li role="separator" class="divider"></li>';
        }

        table += "</ul>";

        $("#searchTable").html(table);

        focusFirst();
}

function focusFirst()
{   

    $('li.projectName').first().on("focus",function() {
        debugger;
        alert("f");
        var z = $(this);
        z.addClass('active').siblings().removeClass();
        alert("focused");
    })
    .addClass('active')
    .on('keydown', 'li', function(e) {
    $this = $(this);
    if (e.keyCode == 40) {        
        $this.next().focus();
        return false;
    } else if (e.keyCode == 38) {        
        $this.prev().focus();
        return false;
    }
});











    

    /*$('.projectName').first().focus(function() {
        debugger;
        $this = $(this);
        $this.addClass('active').siblings().removeClass();
    });*/


    /*$('#testdiv').on('focus', 'li', function() {
    $this = $(this);
    $this.addClass('active').siblings().removeClass();
    $this.closest('#testdiv').scrollTop($this.index() * $this.outerHeight());
}).on('keydown', 'li', function(e) {
    $this = $(this);
    if (e.keyCode == 40) {        
        $this.next().focus();
        return false;
    } else if (e.keyCode == 38) {        
        $this.prev().focus();
        return false;
    }
}).find('li').first().focus();*/
}


function addSearch123(data,searchText)
{
    var table = "<table>";

        for (var pcount = 0; pcount < data.length; pcount++)
        {       

            table += "<tr><td>" + highlightWords(data[pcount].name,searchText) + "</td>";
            table += "<td><ul>";
            //debugger;
            for (var groupCount = 0; groupCount < data[pcount].groups.length; groupCount++) {
                table += "<li>"+highlightWords(data[pcount].groups[groupCount].name,searchText)+"</li>";
            }

            table += "</td></ul>";
        }

        table += "</table>";

        $("#searchTable").html(table);
}



function highlightWords( line, word )
{
     var regex = new RegExp( '(' + word + ')', 'gi' );
     return line.replace( regex, "<span class='highlight'>$1</span>" );
}


function search(searchText)
{
    //clear the search interval
    clearInterval(searchInterval);

    var newData = JSON.parse(JSON.stringify(data)); //copy the data array

    if (searchText == "")
    {
        addSearch(newData);
        return;
    }

    for (var pcount = 0; pcount < newData.length; pcount++)
    {           
        for (var groupCount = 0; groupCount < newData[pcount].groups.length; groupCount++) 
        {
                var groupRes = newData[pcount].groups[groupCount].name.toLowerCase().split(searchText);

                if (groupRes.length == 1)
                {
                    newData[pcount].groups.splice(groupCount,1);
                    groupCount--;
                    continue;
                }
                
        }

        var ProjectRes = newData[pcount].name.toLowerCase().split(searchText);  

        if (ProjectRes.length == 1 && newData[pcount].groups.length == 0)
        {
            newData.splice(pcount,1);
            pcount--;
        }       
    }   

    addSearch(newData,searchText);


}



</script>